<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Page Helper</title>
<meta name="description" content="Page Helper">
<style>
  :root {
    --bg:#0b0d10; --fg:#e8eef2; --muted:#9fb0bf; --card:#14181d; --border:#243442; --accent:#7bdcff;
    --mono: ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;
    --sans: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans";
  }
  @media (prefers-color-scheme: light) {
    :root { --bg:#f7fafc; --fg:#0b0d10; --muted:#475569; --card:#ffffff; --border:#e2e8f0; --accent:#0ea5e9; }
  }
  html,body { margin:0; background:var(--bg); color:var(--fg); font-family:var(--sans); }
  header { padding:20px 16px; border-bottom:1px solid var(--border); background:linear-gradient(180deg, rgba(123,220,255,.12), transparent); }
  h1 { margin:0 0 6px; font-size:clamp(22px,3vw,28px); }
  .lead { color:var(--muted); margin:0; }
  main { max-width:1000px; margin:0 auto; padding:18px 16px 80px; }
  .toolbar { display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin:8px 0 14px; }
  button { border:1px solid var(--border); background:var(--card); color:var(--fg); padding:8px 12px; border-radius:10px; cursor:pointer; font-weight:600; }
  button:hover { border-color:var(--accent); }
  .cards { display:grid; gap:14px; grid-template-columns:1fr; }
  @media (min-width: 900px){ .cards{ grid-template-columns:1fr 1fr; } }
  .card { background:var(--card); border:1px solid var(--border); border-radius:12px; padding:14px; }
  .card h2 { margin:2px 0 10px; font-size:16px; }
  dl { margin:0; }
  dt { color:var(--muted); font-size:13px; margin-top:8px; }
  dd { margin:2px 0 8px; font-family:var(--mono); font-size:13px; word-break:break-word; }
  .note { font-size:12px; color:var(--muted); margin-left:auto; }
  .preview-wrap { margin-top:16px; }
  .preview-wrap h3 { margin:8px 0 8px; font-size:15px; color:var(--muted); }
  .img-frame { border:1px solid var(--border); border-radius:12px; padding:6px; background:var(--card); }
  #pngPreview { max-width:100%; height:auto; display:block; }
  canvas { display:none; } /* used internally to render PNG */
</style>
</head>
<body>
<header>
  <h1>Page Helpder</h1>
  <p class="lead">Runs locally.</p>
</header>

<main>
  <div class="toolbar">
    <button id="refreshBtn">â†» Refresh</button>
    <button id="copyBtn">ðŸ“‹ Copy JSON</button>
  </div>

  <div class="cards">
    <section class="card"><h2>User Agent & Client Hints</h2><dl id="uaList"></dl></section>
    <section class="card"><h2>Platform, Locale, Time</h2><dl id="platList"></dl></section>
    <section class="card"><h2>Screen & Viewport</h2><dl id="screenList"></dl></section>
    <section class="card"><h2>Hardware & Features</h2><dl id="hwList"></dl></section>
    <section class="card"><h2>Network (Browser-reported)</h2><dl id="netList"></dl></section>
    <section class="card"><h2>Storage (Estimate Only)</h2><dl id="storeList"></dl></section>
    <section class="card"><h2>Document & Navigation</h2><dl id="docList"></dl></section>
    <section class="card"><h2>Capabilities</h2><dl id="capList"></dl></section>
  </div>

  <div class="preview-wrap">
    <h3>Picture</h3>
    <div class="img-frame">
      <img id="pngPreview" alt="Generated PNG preview of your browser details" />
    </div>
  </div>

  <canvas id="pngCanvas" width="1400" height="0"></canvas>
</main>

<script>
  // --- Helpers
  const $ = s => document.querySelector(s);
  const addKV = (root, k, v) => {
    const dt = document.createElement('dt'); dt.textContent = k;
    const dd = document.createElement('dd'); dd.textContent = (v === undefined || v === null) ? 'â€”' : String(v);
    root.appendChild(dt); root.appendChild(dd);
  };
  const addJSON = (root, k, obj) => addKV(root, k, obj ? JSON.stringify(obj, null, 2) : 'â€”');
  const bytes = (n) => (typeof n === 'number') ? Intl.NumberFormat().format(n) + ' B' : 'â€”';

  const state = { data: {}, sections: [] };

  // --- Collectors
  async function collectAll(){
    state.data = {}; state.sections = [];
    clearAll();
    collectUA(); collectPlatform(); collectScreen(); collectHardware(); collectNetwork(); await collectStorage(); collectDoc(); collectCapabilities();
    await previewPNG(); // show inline image after collecting
  }
  function clearAll(){
    ['uaList','platList','screenList','hwList','netList','storeList','docList','capList'].forEach(id => { const el = document.getElementById(id); if (el) el.innerHTML=''; });
  }

  function pushSection(title, obj){
    state.sections.push({ title, entries: Object.entries(obj).map(([k, v]) => [k, v]) });
    Object.assign(state.data, { [title]: obj });
  }

  function collectUA(){
    const root = $('#uaList');
    const ua = navigator.userAgent || 'â€”';
    addKV(root, 'navigator.userAgent', ua);
    const uad = navigator.userAgentData;
    if (uad) {
      addJSON(root, 'userAgentData.brands', uad.brands || []);
      addKV(root, 'userAgentData.mobile', uad.mobile);
      addKV(root, 'userAgentData.platform', uad.platform);
    }
    pushSection('User Agent', {
      'navigator.userAgent': ua,
      ...(uad ? {
        'ua.brands': (uad.brands||[]).map(b=>`${b.brand} ${b.version}`).join(' | ') || 'â€”',
        'ua.mobile': uad.mobile,
        'ua.platform': uad.platform
      } : {})
    });
  }

  function collectPlatform(){
    const root = $('#platList');
    const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
    addKV(root, 'platform', navigator.platform);
    addKV(root, 'language', navigator.language);
    addJSON(root, 'languages', navigator.languages || [navigator.language]);
    addKV(root, 'timeZone', tz);
    addKV(root, 'now (ISO)', new Date().toISOString());
    pushSection('Platform/Locale/Time', {
      platform: navigator.platform,
      language: navigator.language,
      languages: (navigator.languages || [navigator.language]).join(', '),
      timeZone: tz,
      nowISO: new Date().toISOString()
    });
  }

  function collectScreen(){
    const root = $('#screenList');
    const dpr = window.devicePixelRatio || 1;
    addKV(root, 'screen.width Ã— height', `${screen.width} Ã— ${screen.height}`);
    addKV(root, 'innerWidth Ã— innerHeight', `${innerWidth} Ã— ${innerHeight}`);
    addKV(root, 'devicePixelRatio', dpr);
    pushSection('Screen/Viewport', {
      'screen': `${screen.width} Ã— ${screen.height}`,
      'viewport': `${innerWidth} Ã— ${innerHeight}`,
      'devicePixelRatio': dpr
    });
  }

  function collectHardware(){
    const root = $('#hwList');
    const prefersReducedMotion = matchMedia('(prefers-reduced-motion: reduce)').matches;
    addKV(root, 'hardwareConcurrency (cores)', navigator.hardwareConcurrency ?? 'â€”');
    addKV(root, 'deviceMemory (GiB, approx)', navigator.deviceMemory ?? 'â€”');
    addKV(root, 'maxTouchPoints', navigator.maxTouchPoints ?? 'â€”');
    addKV(root, 'prefers-reduced-motion', prefersReducedMotion);
    pushSection('Hardware/Features', {
      cores: navigator.hardwareConcurrency ?? 'â€”',
      deviceMemoryGiB: navigator.deviceMemory ?? 'â€”',
      maxTouchPoints: navigator.maxTouchPoints ?? 'â€”',
      prefersReducedMotion
    });
  }

  function collectNetwork(){
    const root = $('#netList');
    const c = navigator.connection || navigator.webkitConnection || navigator.mozConnection;
    if (c) {
      addKV(root, 'effectiveType', c.effectiveType);
      addKV(root, 'downlink (Mbps)', c.downlink);
      addKV(root, 'rtt (ms)', c.rtt);
      addKV(root, 'saveData', c.saveData);
      pushSection('Network', {
        effectiveType: c.effectiveType,
        downlinkMbps: c.downlink,
        rttMs: c.rtt,
        saveData: c.saveData
      });
    } else {
      addKV(root, 'navigator.connection', 'not available');
      pushSection('Network', { connection: 'not available' });
    }
  }

  async function collectStorage(){
    const root = $('#storeList');
    if (navigator.storage?.estimate) {
      try {
        const est = await navigator.storage.estimate();
        addKV(root, 'quota', bytes(est.quota));
        addKV(root, 'usage', bytes(est.usage));
        pushSection('Storage (Estimate)', {
          quotaBytes: est.quota ?? 'â€”',
          usageBytes: est.usage ?? 'â€”'
        });
      } catch {
        addKV(root, 'storage.estimate', 'error');
        pushSection('Storage (Estimate)', { error: true });
      }
    } else {
      addKV(root, 'storage', 'not available');
      pushSection('Storage (Estimate)', { available: false });
    }
  }

  function collectDoc(){
    const root = $('#docList');
    addKV(root, 'referrer', document.referrer || 'â€”');
    addKV(root, 'visibilityState', document.visibilityState);
    pushSection('Document/Navigation', {
      referrer: document.referrer || 'â€”',
      visibility: document.visibilityState
    });
  }

  function collectCapabilities(){
    const root = $('#capList');
    const caps = {
      geolocation: !!navigator.geolocation,
      clipboard: !!navigator.clipboard,
      webgl: 'WebGLRenderingContext' in window,
      notifications: 'Notification' in window,
      serviceWorker: 'serviceWorker' in navigator
    };
    Object.entries(caps).forEach(([k,v]) => addKV(root, k, v));
    pushSection('Capabilities', caps);
  }

  // --- SVG builder reused for PNG render
  function buildSVG(){
    const pad = 24, lineH = 18, titleH = 22, cardGap = 20, cardPad = 16, colGap = 40;
    const colWidth = 620; const cols = 2;
    const entryLines = s => String(s).split(/\r?\n/).length;
    const cardHeights = state.sections.map(sec => {
      let h = titleH + 8;
      sec.entries.forEach(([k, v]) => { h += lineH * Math.max(1, entryLines(v)); });
      return h + cardPad*2;
    });
    const colHeights = Array(cols).fill(0);
    const positions = state.sections.map((_, i) => {
      const col = (colHeights[0] <= colHeights[1]) ? 0 : 1;
      const x = pad + col * (colWidth + colGap);
      const y = pad + colHeights[col];
      colHeights[col] += cardHeights[i] + cardGap;
      return { x, y, w: colWidth, h: cardHeights[i] };
    });
    const width = pad*2 + cols*colWidth + (cols-1)*colGap;
    const height = Math.max(...colHeights) + pad;
    const esc = s => String(s).replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
    const now = new Date().toISOString();
    let svg = `<svg xmlns="http://www.w3.org/2000/svg" width="${width}" height="${height}" role="img" aria-label="Browser Inspector">
  <style>
    .bg { fill: ${getComputedStyle(document.documentElement).getPropertyValue('--bg').trim() || '#0b0d10'}; }
    .card { fill: ${getComputedStyle(document.documentElement).getPropertyValue('--card').trim() || '#14181d'}; stroke: ${getComputedStyle(document.documentElement).getPropertyValue('--border').trim() || '#243442'}; }
    .title { font: 700 14px system-ui, -apple-system, Segoe UI, Roboto, Arial; fill: ${getComputedStyle(document.documentElement).getPropertyValue('--fg').trim() || '#e8eef2'}; }
    .k { font: 600 12px system-ui, -apple-system, Segoe UI, Roboto, Arial; fill: ${getComputedStyle(document.documentElement).getPropertyValue('--muted').trim() || '#9fb0bf'}; }
    .v { font: 12px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; fill: ${getComputedStyle(document.documentElement).getPropertyValue('--fg').trim() || '#e8eef2'}; white-space: pre; }
    .hdr { font: 700 16px system-ui, -apple-system, Segoe UI, Roboto, Arial; fill: ${getComputedStyle(document.documentElement).getPropertyValue('--fg').trim() || '#e8eef2'}; }
    .sub { font: 12px system-ui, -apple-system, Segoe UI, Roboto, Arial; fill: ${getComputedStyle(document.documentElement).getPropertyValue('--muted').trim() || '#9fb0bf'}; }
  </style>
  <rect class="bg" x="0" y="0" width="${width}" height="${height}" rx="0"/>
  <text x="${pad}" y="${pad-6}" class="hdr">Browser Inspector â€” ${esc(now)}</text>
  <text x="${pad}" y="${pad+10}" class="sub">Local-only render (no network). Theme matches your system preference.</text>
`;
    let cursorYs = state.sections.map(() => 0); // not used externally; we compute inside loop
    state.sections.forEach((sec, i) => {
      const { x, y, w, h } = positions[i];
      svg += `  <g>
    <rect class="card" x="${x}" y="${y}" width="${w}" height="${h}" rx="12"/>
    <text class="title" x="${x+16}" y="${y+16+12}">${esc(sec.title)}</text>
`;
      let cy = y + 16 + 12 + 8 + 6;
      sec.entries.forEach(([k, v]) => {
        const val = String(v ?? 'â€”');
        const lines = val.split(/\r?\n/);
        svg += `    <text class="k" x="${x+16}" y="${cy}">${esc(k)}</text>\n`;
        cy += 14;
        lines.forEach(ln => {
          svg += `    <text class="v" x="${x+16}" y="${cy}">${esc(ln)}</text>\n`;
          cy += 16;
        });
        cy += 2;
      });
      svg += '  </g>\n';
    });
    svg += '</svg>';
    return svg;
  }

  async function previewPNG(){
    const svg = buildSVG();
    const url = URL.createObjectURL(new Blob([svg], { type: 'image/svg+xml' }));
    const img = new Image();
    const doc = new DOMParser().parseFromString(svg, 'image/svg+xml');
    const w = parseInt(doc.documentElement.getAttribute('width'), 10);
    const h = parseInt(doc.documentElement.getAttribute('height'), 10);
    const canvas = $('#pngCanvas');
    canvas.width = w; canvas.height = h;
    const ctx = canvas.getContext('2d');

    await new Promise((res, rej) => { img.onload = res; img.onerror = rej; img.src = url; });
    ctx.drawImage(img, 0, 0);
    URL.revokeObjectURL(url);

    const dataURL = canvas.toDataURL('image/png');
    $('#pngPreview').src = dataURL;
  }

  // --- UI
  $('#refreshBtn').addEventListener('click', collectAll);
  $('#copyBtn').addEventListener('click', async () => {
    try {
      await navigator.clipboard.writeText(JSON.stringify(state.data, null, 2));
      alert('Copied JSON to clipboard.');
    } catch { alert('Clipboard not available.'); }
  });

  // keep viewport section + image fresh on resize
  addEventListener('resize', async () => {
    const list = $('#screenList'); list.innerHTML = '';
    collectScreen();
    // update the stored section for image layout
    const i = state.sections.findIndex(s => s.title === 'Screen/Viewport');
    if (i !== -1) state.sections[i] = { title: 'Screen/Viewport', entries: Object.entries({
      'screen': `${screen.width} Ã— ${screen.height}`,
      'viewport': `${innerWidth} Ã— ${innerHeight}`,
      'devicePixelRatio': window.devicePixelRatio || 1
    })};
    await previewPNG();
  }, { passive: true });

  // Initial render
  collectAll();
</script>
</body>
</html>
